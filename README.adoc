= AWS Deployment Pipeline
:toc:
:!toc-placement:
:!toc-title:

[abstract]
A deployment pipeline for provisioning your resources into AWS

toc::[]

== About

This module gives your environment a deployment pipeline for your applications.
Using a simple YAML file, you can deploy any repo you want!

Here is how simple it can be to deploy a terraform repository:
[source,yaml]
----
# .deployment/config.yaml

# This defines what each environment should do on deployment.
deployment:
  steps:
    - deploy_terraform:
        version: 1.0.8

# This is the order that deployments happen.
# In this case it's first service, test and stage that gets deployed.
# Production then deploys when those are successful.
flow:
  - - service
    - test
    - stage
  - prod
----

== Setup

First, we need to make sure the pipeline has permission to deploy to all the relevant accounts.
This is done via the extra permission module.

[source,hcl-terraform]
----
module "deployment_pipeline_permissions" {
  source = "github.com/nsbno/terraform-aws-continuous-delivery//extras/permissions"

  name_prefix = "deployment"
  service_account_id = local.service_account_id
}
----

Now, lets add the actual pipeline to our environment.
Place this module in your `service` account.

[source,hcl-terraform]
----
module "deployment_pipeline" {
  source = "github.com/nsbno/terraform-aws-continuous-delivery/"

  name_prefix = "deployment"

  deployment_accounts = {
    service = "1111111111"
    test = "2222222222"
    stage = "3333333333"
    prod = "4444444444"
  }

  deployment_role = module.deployment_pipeline_permissions.deployment_role
  set_version_role = module.deployment_pipeline_permissions.set_version_role

  account_id = "1111111111"
  subnets = module.vpc.public_subnet_ids
}
----

You can now move onto creating a configuration for each repo that you want to deploy ðŸŽ‰

== Usage

// TODO: Details about the different parts of the YAML config.
